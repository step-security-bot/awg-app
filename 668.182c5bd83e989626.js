(self.webpackChunkawg_app=self.webpackChunkawg_app||[]).push([[668],{5668:(d,v,s)=>{"use strict";s.r(v),s.d(v,{EditionSheetsModule:()=>Y});var a=s(655),t=s(4650),c=s(8831),ee=s(2268);var M,ne=s(2611),se=s.n(ne);let x=((M=class{constructor(){this.browseSvgSheetRequest=new t.vpe,this.navigateToReportFragmentRequest=new t.vpe,this.openModalRequest=new t.vpe,this.selectLinkBoxRequest=new t.vpe,this.selectOverlaysRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe}browseSvgSheet(e){e&&this.browseSvgSheetRequest.emit(e)}navigateToReportFragment(e){e&&this.navigateToReportFragmentRequest.emit(e)}openModal(e){e&&this.openModalRequest.emit(e)}selectLinkBox(e){this.selectLinkBoxRequest.emit(e)}selectOverlays(e){this.selectOverlaysRequest.emit(e)}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}}).propDecorators={svgSheetsData:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],selectedTextcriticalComments:[{type:t.IIB}],selectedTextcritics:[{type:t.IIB}],showTkA:[{type:t.IIB}],browseSvgSheetRequest:[{type:t.r_U}],navigateToReportFragmentRequest:[{type:t.r_U}],openModalRequest:[{type:t.r_U}],selectLinkBoxRequest:[{type:t.r_U}],selectOverlaysRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]},M);x=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-accolade",template:'<ngb-accordion #accoladeAcc="ngbAccordion" id="accoladeAcc" activeIds="awg-accolade-view">\n    <ngb-panel id="awg-accolade-view">\n        <ng-template ngbPanelHeader>\n            <div class="accordion-button awg-accordion-button-custom-header justify-content-between">\n                <button ngbPanelToggle class="p-0 btn btn-link text-start">Edierte Notentexte</button>\n                <button type="button" class="btn btn-sm btn-outline-info" (click)="openModal(\'HINT_EDITION_SHEETS\')">\n                    Hinweise zur Nutzung\n                </button>\n            </div>\n        </ng-template>\n        <ng-template ngbPanelContent>\n            <div class="row">\n                <div class="order-2 order-lg-1 col-12 col-lg-4 col-xl-3">\n                    \x3c!-- svg sheet navigation --\x3e\n                    <awg-edition-svg-sheet-nav\n                        *ngIf="svgSheetsData && selectedSvgSheet"\n                        [svgSheetsData]="svgSheetsData"\n                        [selectedSvgSheet]="selectedSvgSheet"\n                        (selectSvgSheetRequest)="selectSvgSheet($event)">\n                    </awg-edition-svg-sheet-nav>\n                </div>\n                <div class="order-1 order-lg-2 col-12 col-lg-8 col-xl-9">\n                    \x3c!-- svg sheet --\x3e\n                    <awg-edition-svg-sheet-viewer\n                        *ngIf="selectedSvgSheet"\n                        [selectedSvgSheet]="selectedSvgSheet"\n                        (browseSvgSheetRequest)="browseSvgSheet($event)"\n                        (selectLinkBoxRequest)="selectLinkBox($event)"\n                        (selectOverlaysRequest)="selectOverlays($event)"\n                        (selectSvgSheetRequest)="selectSvgSheet($event)">\n                    </awg-edition-svg-sheet-viewer>\n\n                    \x3c!-- table for TkA --\x3e\n                    <awg-edition-svg-sheet-footer\n                        *ngIf="selectedSvgSheet && selectedTextcritics"\n                        [selectedTextcritics]="selectedTextcritics"\n                        [selectedTextcriticalComments]="selectedTextcriticalComments"\n                        [showTkA]="showTkA"\n                        (navigateToReportFragmentRequest)="navigateToReportFragment($event)"\n                        (openModalRequest)="openModal($event)"\n                        (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-footer>\n                </div>\n            </div>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:t.n4l.OnPush,styles:[se()]})],x);var C,oe=s(6248),re=s.n(oe),b=s(2687),B=s(2778);let F=((C=class{constructor(e){this.utils=e,this.navigateToReportFragmentRequest=new t.vpe,this.openModalRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.faChevronRight=b._tD,this.faChevronUp=b.mTx,this.showTextcritics=!1,this.ref=this}navigateToReportFragment(e){e&&this.navigateToReportFragmentRequest.emit(e)}openModal(e){e&&this.openModalRequest.emit(e)}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}toggleTextcritics(){this.showTextcritics=!this.showTextcritics}}).ctorParameters=()=>[{type:B.tI}],C.propDecorators={selectedTextcriticalComments:[{type:t.IIB}],selectedTextcritics:[{type:t.IIB}],showTkA:[{type:t.IIB}],navigateToReportFragmentRequest:[{type:t.r_U}],openModalRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]},C);F=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-footer",template:'<div class="awg-edition-svg-sheet-footer mt-4">\n    <div class="awg-edition-svg-sheet-footer-evaluation">\n        <p (click)="toggleTextcritics()" style="cursor: pointer">\n            <span *ngIf="selectedTextcritics.description && utils.isNotEmptyArray(selectedTextcritics.description)">\n                <fa-icon [icon]="showTextcritics ? faChevronUp : faChevronRight"></fa-icon>\n                &nbsp;\n            </span>\n            <span class="caps">Skizzenkommentar:</span>\n            <span *ngIf="selectedTextcritics.description && !utils.isNotEmptyArray(selectedTextcritics.description)"\n                >&nbsp;---</span\n            >\n        </p>\n        <ng-container\n            *ngIf="\n                showTextcritics &&\n                selectedTextcritics.description &&\n                utils.isNotEmptyArray(selectedTextcritics.description)\n            ">\n            <p\n                class="awg-edition-svg-sheet-footer-evaluation-desc"\n                *ngFor="let description of selectedTextcritics.description"\n                [compile-html]="description"\n                [compile-html-ref]="ref"></p>\n        </ng-container>\n    </div>\n    <div class="awg-edition-svg-sheet-footer-textcritics" *ngIf="showTkA">\n        <p class="caps">Textkritischer Kommentar:</p>\n        <awg-edition-tka-table\n            [textcriticalComments]="selectedTextcriticalComments"\n            [isRowTable]="selectedTextcritics.rowtable"\n            (navigateToReportFragmentRequest)="navigateToReportFragment($event)"\n            (openModalRequest)="openModal($event)"\n            (selectSvgSheetRequest)="selectSvgSheet($event)">\n        </awg-edition-tka-table>\n    </div>\n</div>\n',changeDetection:t.n4l.OnPush,styles:[re()]})],F);var z,le=s(9253),ce=s.n(le);let N=((z=class{constructor(){this.selectSvgSheetRequest=new t.vpe}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}}).propDecorators={svgSheetsData:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],selectSvgSheetRequest:[{type:t.r_U}]},z);N=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-nav",template:'<div *ngIf="svgSheetsData" class="awg-svg-sheet-nav card">\n    <div class="card-body">\n        <awg-edition-svg-sheet-nav-item\n            [navItemLabel]="\'Werkeditionen\'"\n            [svgSheets]="svgSheetsData.sheets.workEditions"\n            [selectedSvgSheet]="selectedSvgSheet"\n            (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-nav-item>\n\n        <hr />\n\n        <awg-edition-svg-sheet-nav-item\n            [navItemLabel]="\'Texteditionen\'"\n            [svgSheets]="svgSheetsData.sheets.textEditions"\n            [selectedSvgSheet]="selectedSvgSheet"\n            (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-nav-item>\n\n        <hr />\n\n        <awg-edition-svg-sheet-nav-item\n            [navItemLabel]="\'Skizzeneditionen\'"\n            [svgSheets]="svgSheetsData.sheets.sketchEditions"\n            [selectedSvgSheet]="selectedSvgSheet"\n            (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-nav-item>\n    </div>\n</div>\n',changeDetection:t.n4l.OnPush,styles:[ce()]})],N);var O,ge=s(55),he=s.n(ge);let q=((O=class{constructor(e){this.utils=e,this.selectSvgSheetRequest=new t.vpe}isSelectedSvgSheet(e,n){let o=e,r=this.selectedSvgSheet.id;return n&&this.selectedSvgSheet.content?.[0]?.partial&&(o+=n,r+=this.selectedSvgSheet.content[0].partial),o===r}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}}).ctorParameters=()=>[{type:B.tI}],O.propDecorators={navItemLabel:[{type:t.IIB}],svgSheets:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],selectSvgSheetRequest:[{type:t.r_U}]},O);q=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-nav-item",template:'<h6 class="card-title">{{ navItemLabel }}: <span *ngIf="!utils.isNotEmptyArray(svgSheets)">---</span></h6>\n<ng-container *ngFor="let svgSheet of svgSheets">\n    <a\n        *ngIf="svgSheet.content.length === 1"\n        class="btn btn-default w-100 awg-svg-sheet-nav-link card-text text-start"\n        [ngClass]="{ active: isSelectedSvgSheet(svgSheet.id), \'text-muted\': !isSelectedSvgSheet(svgSheet.id) }"\n        (click)="selectSvgSheet(svgSheet.id)">\n        {{ svgSheet.label }}\n    </a>\n    <div *ngIf="svgSheet.content.length > 1" class="awg-svg-sheet-nav-link-dropdown" ngbDropdown>\n        <a\n            class="btn card-text"\n            id="dropDownSheetNav"\n            ngbDropdownToggle\n            [ngClass]="{ active: isSelectedSvgSheet(svgSheet.id), \'text-muted\': !isSelectedSvgSheet(svgSheet.id) }">\n            <span\n                >{{ svgSheet.label }} <span class="badge bg-secondary">{{ svgSheet.content.length }}</span></span\n            >\n        </a>\n        <div ngbDropdownMenu aria-labelledby="dropdownSheetNav">\n            <div *ngFor="let svgSheetContent of svgSheet.content; let i = index">\n                <a\n                    class="dropdown-item"\n                    [ngClass]="{\n                        active: isSelectedSvgSheet(svgSheet.id, svgSheetContent.partial),\n                        \'text-muted\': !isSelectedSvgSheet(svgSheet.id, svgSheetContent.partial)\n                    }"\n                    (click)="selectSvgSheet(svgSheet.id + svgSheetContent.partial)"\n                    >{{ svgSheet.label }} <span class="text-muted">[{{ i + 1 }}/{{ svgSheet.content.length }}]</span></a\n                >\n            </div>\n        </div>\n    </div>\n</ng-container>\n',styles:[he()]})],q);var ve=s(5861);var E,pe=s(7167),ue=s.n(pe),G=s(7579),me=s(8372),Q=s(2722),_e=s(22),y=s(7307),T=s(366),fe=s(4967);let $=((E=class{constructor(e){this.svgDrawingService=e,this.browseSvgSheetRequest=new t.vpe,this.selectLinkBoxRequest=new t.vpe,this.selectOverlaysRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.faCompressArrowsAlt=b.udn,this.sliderConfig=new _e.w(1,.1,10,.01,1),this.svgSheetFilePath="",this._availableOverlays=[],this._selectedOverlays=[],this._isRendered=!1,this._resize$=new G.x,this._destroyed$=new G.x,this.ref=this}onResize(){!this.svgSheetSelection||!this.svgSheetRootGroupSelection||(this._getContainerDimensions(this.svgSheetContainerRef),this._resize$.next(!0))}ngOnChanges(){this._isRendered&&this.renderSheet()}ngAfterViewInit(){this._resize$.pipe((0,me.b)(150),(0,Q.R)(this._destroyed$)).subscribe(e=>{this.renderSheet()}),this.renderSheet(),this._isRendered=!0}ngOnDestroy(){this._destroyed$.next(!0),this._destroyed$.complete()}browseSvgSheet(e){e&&this.browseSvgSheetRequest.emit(e)}onZoomChange(e){this.sliderConfig.value=e,this._rescaleZoom()}renderSheet(){this._clearSVG(),this._availableOverlays=[],this._selectedOverlays=[],this.svgSheetFilePath=this.selectedSvgSheet?.content[0].svg,this._createSvg().then(()=>{this.resetZoom(),this._createSvgOverlays()})}resetZoom(){!this.svgSheetSelection||!this.sliderConfig||(this.onZoomChange(this.sliderConfig.initial),this._retranslateZoom())}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}_clearSVG(){this.svgSheetRootGroupSelection?.selectAll("*").remove(),this.svgSheetSelection?.selectAll("*").remove()}_createSvg(){var e=this;return(0,ve.Z)(function*(){e.svgSheetContainerRef?(e.svgSheetSelection=yield e.svgDrawingService.createSvg(e.svgSheetFilePath,e.svgSheetElementRef?.nativeElement,e.svgSheetRootGroupRef?.nativeElement),e.svgSheetRootGroupSelection=e.svgSheetSelection.select("#awg-edition-svg-sheet-root-group"),e._getContainerDimensions(e.svgSheetContainerRef),e._zoomHandler(e.svgSheetRootGroupSelection,e.svgSheetSelection)):console.warn("No svg sheet container ref")})()}_createSvgOverlays(){this.svgSheetRootGroupSelection&&(this._createOverlays("link-box",this._createLinkBoxOverlay.bind(this)),this._createOverlays("tkk",this._createTkkOverlay.bind(this)))}_createOverlays(e,n){const o=this.svgDrawingService.getGroupsBySelector(this.svgSheetRootGroupSelection,e);o&&o.nodes().forEach(r=>{n(r,e)})}_createLinkBoxOverlay(e,n){const o=e.id,r=this.svgDrawingService.getD3SelectionById(this.svgSheetRootGroupSelection,o),i=r.select("path");i.style("fill",this.svgDrawingService.linkBoxFillColor),r.on("mouseover",()=>{const l=this.svgDrawingService.linkBoxHoverFillColor;this.svgDrawingService.fillD3SelectionWithColor(i,l),r.style("cursor","pointer")}).on("mouseout",()=>{const l=this.svgDrawingService.linkBoxFillColor;this.svgDrawingService.fillD3SelectionWithColor(i,l)}).on("click",()=>{this._onLinkBoxSelect(o)})}_createTkkOverlay(e,n){const o=e.id,r=e.getBBox();this._availableOverlays.push(new y.OZ(y.wN.item,o,!1));const i=this._getOverlayById(this._availableOverlays,o),l=this.svgDrawingService.createOverlayGroup(this.svgSheetRootGroupSelection,o,r,n),h=this.svgDrawingService.getOverlayGroupRectSelection(this.svgSheetRootGroupSelection,o,n);l.on("mouseover",()=>{this.svgDrawingService.updateTkkOverlayColor(i,h,"hover"),h.style("cursor","pointer")}).on("mouseout",()=>{this.svgDrawingService.updateTkkOverlayColor(i,h,"fill")}).on("click",()=>{i&&(i.isSelected=!i.isSelected),this.svgDrawingService.updateTkkOverlayColor(i,h,"hover"),this._selectedOverlays=this._getSelectedOverlays(this._availableOverlays),this._onOverlaySelect(this._selectedOverlays)})}_getContainerDimensions(e){const n=this.svgDrawingService.getContainerDimensions(e);this._divWidth=this._divWidth?this._divWidth:n.width,this._divHeight=this._divHeight?this._divHeight:n.height}_getSelectedOverlays(e){return e.filter(n=>n.isSelected)}_getOverlayById(e,n){return e.find(o=>o.id===n)}_onOverlaySelect(e){this.selectOverlaysRequest.emit(e)}_onLinkBoxSelect(e){this.selectLinkBoxRequest.emit(e)}_rescaleZoom(){!this.svgSheetSelection||!this.sliderConfig.value||this._zoomBehaviour.scaleTo(this.svgSheetSelection,this.sliderConfig.value)}_retranslateZoom(){this.svgSheetSelection&&this.svgSheetRootGroupSelection.attr("transform","translate(0,0)")}_roundToNearestScaleStep(e){const n=this.sliderConfig.stepSize;return((i,l)=>Number(Math.round(Number(i+"e"+l))+"e-"+l))(e,(i=n,Math.floor(i)===i?0:i.toString().split(".")[1].length||0));var i}_zoomHandler(e,n){this._zoomBehaviour=fe.sP().scaleExtent([this.sliderConfig.min,this.sliderConfig.max]).on("zoom",r=>{const i=r.transform,l=this._roundToNearestScaleStep(i.k);e.attr("transform",i),this.sliderInput&&this.sliderInput.nativeElement&&(this.sliderInput.nativeElement.value=l,this.sliderConfig.value=l),this.sliderInputLabel&&this.sliderInputLabel.nativeElement&&(this.sliderInputLabel.nativeElement.innerText=l+"x")}),n.call(this._zoomBehaviour)}}).ctorParameters=()=>[{type:T.Rt}],E.propDecorators={svgSheetContainerRef:[{type:t.i9L,args:["svgSheetContainer"]}],svgSheetElementRef:[{type:t.i9L,args:["svgSheetElement"]}],svgSheetRootGroupRef:[{type:t.i9L,args:["svgSheetRootGroup"]}],sliderInput:[{type:t.i9L,args:["sliderInput"]}],sliderInputLabel:[{type:t.i9L,args:["sliderInputLabel"]}],selectedSvgSheet:[{type:t.IIB}],browseSvgSheetRequest:[{type:t.r_U}],selectLinkBoxRequest:[{type:t.r_U}],selectOverlaysRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}],onResize:[{type:t.L6J,args:["window:resize"]}]},E);$=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-viewer",template:'<div id="awg-edition-svg-container" *ngIf="selectedSvgSheet">\n    <div class="awg-edition-svg-sheet-viewer">\n        <div class="awg-edition-svg-icon-bar">\n            \x3c!-- Slider --\x3e\n            <div class="input-group input-group-sm awg-edition-svg-zoom-slider-container float-start m-2">\n                <span #sliderInputLabel class="input-group-text" id="slider-label">{{ sliderConfig.value }}x</span>\n                <input\n                    type="range"\n                    #sliderInput\n                    class="awg-edition-svg-zoom-slider"\n                    id="awg-edition-svg-zoom-slider"\n                    name="zoomSlider"\n                    aria-label="Zoom slider"\n                    aria-describedby="slider-label"\n                    [min]="sliderConfig.min"\n                    [max]="sliderConfig.max"\n                    [step]="sliderConfig.stepSize"\n                    [(ngModel)]="sliderConfig.value"\n                    (ngModelChange)="onZoomChange($event)" />\n                <button class="btn btn-sm btn-outline-info" type="submit" title="Reset zoom" (click)="resetZoom()">\n                    <fa-icon [icon]="faCompressArrowsAlt"></fa-icon>\n                </button>\n            </div>\n        </div>\n\n        <div #svgSheetContainer class="awg-edition-svg-sheet-container">\n            <svg #svgSheetElement id="awg-edition-svg-sheet">\n                <g #svgSheetRootGroup id="awg-edition-svg-sheet-root-group"></g>\n            </svg>\n            <awg-license class="d-flex mt-3 text-center small"></awg-license>\n        </div>\n    </div>\n\n    \x3c!-- Next and previous buttons --\x3e\n    <div class="awg-edition-svg-sheet-viewer-nav">\n        <div class="prev" (click)="browseSvgSheet(-1)">\n            <span>&#10094;</span>\n        </div>\n        <div class="next" (click)="browseSvgSheet(1)">\n            <span>&#10095;</span>\n        </div>\n    </div>\n</div>\n',styles:[ue()]})],$);let U=class{};U=(0,a.gn)([(0,t.LVF)({imports:[c.m,ee.K],declarations:[x,F,N,q,$],exports:[x]})],U);var H,Re=s(9335),ye=s.n(Re);let I=((H=class{constructor(){this.openModalRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.faSquare=b.pL1,this.folioLegends=[{color:"olivedrab",label:"aktuell ausgew\xe4hlt"},{color:"orange",label:"ausw\xe4hlbar"},{color:"grey",label:"(momentan noch) nicht ausw\xe4hlbar"}]}openModal(e){e&&this.openModalRequest.emit(e)}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}}).propDecorators={selectedConvolute:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],openModalRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]},H);I=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-convolute",template:'<ngb-accordion activeIds="awg-convolute-view">\n    <ngb-panel id="awg-convolute-view" title="Konvolut\xfcbersicht">\n        <ng-template ngbPanelContent>\n            \x3c!-- convolute label --\x3e\n            <div class="awg-convolute-label">\n                <p>\n                    <a [routerLink]="[\'../report\']" fragment="source{{ selectedConvolute.convoluteId }}">{{\n                        selectedConvolute.convoluteLabel\n                    }}</a>\n                </p>\n            </div>\n\n            \x3c!-- viewer for convolute folios --\x3e\n            <awg-edition-folio-viewer\n                [selectedConvolute]="selectedConvolute"\n                [selectedSvgSheet]="selectedSvgSheet"\n                (openModalRequest)="openModal($event)"\n                (selectSvgSheetRequest)="selectSvgSheet($event)">\n            </awg-edition-folio-viewer>\n\n            \x3c!-- convolute legend --\x3e\n            <div class="awg-convolute-legend col-12">\n                Legende:&nbsp;\n                <ng-container *ngFor="let legend of folioLegends">\n                    <span class="{{ legend.color }}">\n                        <fa-icon [icon]="faSquare"></fa-icon>\n                        {{ legend.label }}\n                    </span>\n                </ng-container>\n            </div>\n        </ng-template>\n    </ngb-panel>\n</ngb-accordion>\n',changeDetection:t.n4l.OnPush,styles:[ye()]})],I);var be=s(4756),Ce=s.n(be);let V=class{constructor(){this._itemsOffsetCorrection=4}getFolioSvgData(e,n){const o=new y.jD(e,n,this._itemsOffsetCorrection);return new y.Hb(o)}addViewBoxToSnapSvgCanvas(e,n){e.attr({viewBox:n.viewBox,width:n.svgWidth,height:n.svgHeight,version:"1.1",xmlns:"https://www.w3.org/2000/svg",xlink:"https://www.w3.org/1999/xlink",preserveAspectRatio:"xMinYMin meet"})}addFolioToSnapSvgCanvas(e,n,o,r,i){this.ref=i;const l=e.group();this._addFolioSheetToSnapSvgCanvas(e,l,n,o),this._addFolioSystemsToSnapSvgCanvas(e,l,n,o),this._addFolioItemsToSnapSvgCanvas(e,l,n,r)}_addFolioSheetToSnapSvgCanvas(e,n,o,r){const i=o.sheet.folioId,l=o.sheet.upperLeftCorner.x,h=o.sheet.upperLeftCorner.y,u=o.sheet.lowerRightCorner.x,m=o.sheet.lowerRightCorner.y;n.attr({sheetGroupId:i,class:"sheet-group"});const f=e.rect(l,h,u,m);f.attr({fill:"white",stroke:r,strokeWidth:1});const _=Snap.parse("<title>Bl. "+i+"</title>");n.append(_),n.add(f)}_addFolioSystemsToSnapSvgCanvas(e,n,o,r){o.systems.lineArrays.forEach((i,l)=>{const h=e.group();h.attr({systemLineGroupId:l+1,class:"system-line-group"}),i.forEach(w=>{const R=w.startPoint.x,p=w.startPoint.y,K=w.endPoint.x,ke=w.endPoint.y,J=e.line(R,p,K,ke);J.attr({class:"system-line",stroke:r,strokeWidth:.7}),h.add(J)});const u=o.systems.lineLabelArray[l].x,m=o.systems.lineLabelArray[l].y,f=l+1,_=e.text(u,m,f);_.attr({class:"system-label",dominantBaseline:"hanging",fill:r});const S=e.group(h,_);S.attr({systemsGroupId:l+1,class:"systems-group"}),n.add(S)})}_addFolioItemsToSnapSvgCanvas(e,n,o,r){o.contentItemsArray.forEach(i=>{if(!i)return;const l=i.upperLeftCorner.x+i.width/2,h=i.upperLeftCorner.y+i.height/2,u=i.sigleAddendum?[i.sigle," "+i.sigleAddendum]:[i.sigle],m=e.text(0,0,u);m.attr({class:"item-label",style:"font: 12px Source Sans Pro, source-sans-pro, sans-serif",dominantBaseline:"middle"});const f="middle";m.select("tspan:first-of-type").attr({x:l,y:h,textAnchor:f}),u.length>1&&m.select("tspan:last-of-type").attr({x:l,y:h,textAnchor:f,dy:"1.2em"});const _=e.group(),S=[];S.push(i.cornerPoints.upperLeftCorner.x,i.cornerPoints.upperLeftCorner.y),S.push(i.cornerPoints.upperRightCorner.x,i.cornerPoints.upperRightCorner.y),S.push(i.cornerPoints.lowerRightCorner.x,i.cornerPoints.lowerRightCorner.y),S.push(i.cornerPoints.lowerLeftCorner.x,i.cornerPoints.lowerLeftCorner.y),S.push(i.cornerPoints.upperLeftCorner.x,i.cornerPoints.upperLeftCorner.y);const w=e.polyline(S);_.add(w),_.attr({class:"item-shape",strokeWidth:2,fill:"#eeeeee"});const R=e.el("a");R.attr({class:"item-link"}),R.add(_),R.add(m);const p=e.group(R);p.attr({itemGroupId:u,itemId:i.id,class:"item-group"});const K=Snap.parse("<title>"+u+"</title>");p.append(K),!1===i.selectable?(p.click(()=>this.ref.openModal(i.linkTo)),p.attr({stroke:"grey",fill:"grey"})):(p.click(()=>this.ref.selectSvgSheet(i.id)),p.attr({stroke:r,fill:r})),n.add(p)})}};var D;V=(0,a.gn)([(0,t.GSi)({providedIn:"root"})],V);let A=((D=class{constructor(e){this.folioService=e,this.openModalRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.canvasArray=[],this.folioSvgData=[],this.vbArray=[],this.bgColor="#a3a3a3",this.fgColor="orange",this._folioSettings={factor:1.5,formatX:175,formatY:270,initialOffsetX:5,initialOffsetY:5,numberOfFolios:0},this.ref=this}get folioSettings(){return this._folioSettings}set folioSettings(e){this._folioSettings=e}ngOnChanges(e){e.selectedConvolute&&this.prepareFolioSvgOutput()}ngAfterViewChecked(){this.createSVGCanvas()}isSelectedSvgSheet(e){let n="";return this.selectedSvgSheet.content[0].partial&&(n=this.selectedSvgSheet.content[0].partial),e===this.selectedSvgSheet.id+n}prepareFolioSvgOutput(){this.folioSvgData=[],this.selectedConvolute.folios.forEach((e,n)=>{this.folioSettings={factor:this.folioSettings.factor,formatX:+e.format.width,formatY:+e.format.height,initialOffsetX:this.folioSettings.initialOffsetX,initialOffsetY:this.folioSettings.initialOffsetY,numberOfFolios:+this.selectedConvolute.folios.length};const o=(this.folioSettings.formatX+2*this.folioSettings.initialOffsetX)*this.folioSettings.factor,r=(this.folioSettings.formatY+2*this.folioSettings.initialOffsetY)*this.folioSettings.factor;this.vbArray[n]=new y.HA(o,r),this.folioSvgData[n]=this.folioService.getFolioSvgData(this.folioSettings,e)})}createSVGCanvas(){this.canvasArray=[],this.folioSvgData.forEach((e,n)=>{const o="#folio-"+this.selectedSvgSheet.id+"-"+e.sheet.folioId,r=Snap(o);r&&(this.folioService.addViewBoxToSnapSvgCanvas(r,this.vbArray[n]),this.folioService.addFolioToSnapSvgCanvas(r,e,this.bgColor,this.fgColor,this.ref),this.canvasArray.push(r))}),this.toggleActiveClass()}toggleActiveClass(){this.canvasArray&&this.canvasArray.forEach(e=>{e.selectAll(".item-group").forEach(n=>{const o=n.node.attributes.itemId.value;n.toggleClass("active",this.isSelectedSvgSheet(o))})})}openModal(e){this.openModalRequest.emit(e)}selectSvgSheet(e){this.selectSvgSheetRequest.emit(e)}}).ctorParameters=()=>[{type:V}],D.propDecorators={selectedConvolute:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],openModalRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]},D);A=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-folio-viewer",template:'\x3c!-- embedded svg: EditionSvgSheet Overview --\x3e\n<div class="container-fluid svgGrid" *ngIf="folioSvgData">\n    <div class="row svgRow">\n        <div class="col-sm-6 col-lg-{{ 12 / folioSvgData?.length }} svgCol" *ngFor="let folio of folioSvgData">\n            <span class="text-muted">[{{ folio.sheet.folioId }}]</span>\n            <svg id="folio-{{ selectedSvgSheet.id }}-{{ folio.sheet.folioId }}"></svg>\n        </div>\n    </div>\n</div>\n',changeDetection:t.n4l.OnPush,styles:[Ce()]})],A);let X=class{};X=(0,a.gn)([(0,t.LVF)({imports:[c.m],declarations:[A],exports:[A]})],X);let Z=class{};Z=(0,a.gn)([(0,t.LVF)({imports:[c.m,X],declarations:[I],exports:[I]})],Z);var k=s(5867);var L,Te=s(5262),Ee=s.n(Te),j=s(3900),Ie=s(141);let P=((L=class{constructor(e,n,o,r,i,l){this.editionDataService=e,this.editionSheetsService=n,this.editionService=o,this.utils=r,this.route=i,this.router=l,this.errorMessage=void 0,this.showTkA=!1,this._destroyed$=new G.x}get editionRouteConstants(){return Ie.LL}ngOnInit(){this.getEditionSheetsData()}getEditionSheetsData(){this.route.paramMap.pipe((0,j.w)(()=>this.editionService.getEditionComplex()),(0,j.w)(e=>(this.editionComplex=e,this.editionDataService.getEditionSheetsData(this.editionComplex))),(0,j.w)(e=>(this.folioConvoluteData=e[0],this.svgSheetsData=e[1],this.textcriticsData=e[2],this.route.queryParamMap)),(0,Q.R)(this._destroyed$)).subscribe({next:e=>{this._selectSvgSheet(e)},error:e=>{this.errorMessage=e}})}onLinkBoxSelect(e){if(!this.selectedSvgSheet||!this.selectedTextcritics?.linkBoxes)return;const n=this.selectedTextcritics.linkBoxes.find(o=>o.svgGroupId===e);if(n){const o=n.linkTo;this.onSvgSheetSelect(o)}}onNavigateToReportFragment(e){e||(e="");const n={fragment:e};this.router.navigate([this.editionComplex.baseRoute,this.editionRouteConstants.EDITION_REPORT.route],n)}onOverlaySelect(e){this.selectedTextcriticalComments=this.editionSheetsService.getTextcriticalCommentsForOverlays(this.selectedTextcritics.comments,e),this.showTkA=this.utils.isNotEmptyArray(this.selectedTextcriticalComments)}onBrowseSvgSheet(e){const n=this.editionSheetsService.getCurrentEditionType(this.selectedSvgSheet,this.svgSheetsData.sheets);if(!n)return;const o=this.svgSheetsData.sheets[n],r=this.editionSheetsService.getNextSheetId(e,this.selectedSvgSheet,o);this.onSvgSheetSelect(r)}onSvgSheetSelect(e){e||(e=this.svgSheetsData.sheets.sketchEditions[0].id);const n={queryParams:{id:e},queryParamsHandling:"merge"};this.router.navigate([this.editionComplex.baseRoute,this.editionRouteConstants.EDITION_SHEETS.route],n)}ngOnDestroy(){this._destroyed$.next(!0),this._destroyed$.complete()}_getIdFromQueryParams(e){return e.get("id")?e.get("id"):this.svgSheetsData.sheets.sketchEditions[0].id}_selectSvgSheet(e){const n=this._getIdFromQueryParams(e);this.selectedSvgSheet=this.editionSheetsService.selectSvgSheetById(this.svgSheetsData.sheets,n),this.selectedConvolute=this.editionSheetsService.selectConvolute(this.folioConvoluteData.convolutes,this.svgSheetsData.sheets,this.selectedSvgSheet),this.selectedTextcritics=this.editionSheetsService.findTextcritics(this.textcriticsData.textcritics,this.selectedSvgSheet),this.onOverlaySelect([]),this.utils.isNotEmptyObject(this.selectedTextcritics)&&this.utils.isNotEmptyArray(this.selectedTextcritics.comments)&&(this.selectedTextcriticalComments=this.selectedTextcritics.comments)}}).ctorParameters=()=>[{type:T.Ko},{type:T.rH},{type:T.OE},{type:B.tI},{type:k.gz},{type:k.F0}],L.propDecorators={modal:[{type:t.i9L,args:["modal",{static:!0}]}]},L);P=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-sheets",template:'\x3c!-- content: edition detail --\x3e\n<div>\n    \x3c!-- modal --\x3e\n    <awg-modal #modal></awg-modal>\n\n    \x3c!-- body with embedded svg\'s --\x3e\n    \x3c!-- accolade view --\x3e\n    <awg-edition-accolade\n        *ngIf="svgSheetsData && selectedSvgSheet"\n        [svgSheetsData]="svgSheetsData"\n        [selectedSvgSheet]="selectedSvgSheet"\n        [selectedTextcritics]="selectedTextcritics"\n        [selectedTextcriticalComments]="selectedTextcriticalComments"\n        [showTkA]="showTkA"\n        (browseSvgSheetRequest)="onBrowseSvgSheet($event)"\n        (navigateToReportFragmentRequest)="onNavigateToReportFragment($event)"\n        (openModalRequest)="modal.open($event)"\n        (selectLinkBoxRequest)="onLinkBoxSelect($event)"\n        (selectOverlaysRequest)="onOverlaySelect($event)"\n        (selectSvgSheetRequest)="onSvgSheetSelect($event)">\n    </awg-edition-accolade>\n\n    \x3c!-- convolute view --\x3e\n    <awg-edition-convolute\n        *ngIf="selectedConvolute && selectedSvgSheet"\n        [selectedConvolute]="selectedConvolute"\n        [selectedSvgSheet]="selectedSvgSheet"\n        (openModalRequest)="modal.open($event)"\n        (selectSvgSheetRequest)="onSvgSheetSelect($event)">\n    </awg-edition-convolute>\n</div>\n',styles:[Ee()]})],P);const De=[{path:"",component:P,data:{title:"AWG Online Edition \u2013 Sheets"}}],Ae=[P];let W=class{};W=(0,a.gn)([(0,t.LVF)({imports:[k.Bz.forChild(De)],exports:[k.Bz]})],W);let Y=class{};Y=(0,a.gn)([(0,t.LVF)({imports:[c.m,U,Z,W],declarations:[Ae]})],Y)},2611:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"",""]),d.exports=c.toString()},6248:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"",""]),d.exports=c.toString()},55:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"a#dropDownSheetNav.btn {\n  border: none !important;\n}\na#dropDownSheetNav.active, a#dropDownSheetNav:active {\n  color: #149b9e !important;\n}\na#dropDownSheetNav:hover {\n  color: rgb(51, 51, 51) !important;\n}\na#dropDownSheetNav > span {\n  display: inline-block;\n  white-space: break-spaces;\n  text-align: start;\n}",""]),d.exports=c.toString()},9253:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"",""]),d.exports=c.toString()},7167:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,'#awg-edition-svg-container {\n  position: relative;\n  width: 100%;\n}\n#awg-edition-svg-container > .awg-edition-svg-icon-bar {\n  position: relative;\n  width: 100%;\n}\n\n.awg-edition-svg-sheet-container {\n  position: inherit;\n  height: 100%;\n  padding-left: 2rem;\n  padding-right: 2rem;\n}\n\n/* slider */\n.input-group.awg-edition-svg-zoom-slider-container {\n  flex-wrap: nowrap;\n  width: auto;\n  margin-left: 2rem !important;\n}\n.input-group.awg-edition-svg-zoom-slider-container > :not(:first-child) {\n  margin-left: 0px !important;\n}\n\n#slider-label.input-group-text {\n  min-width: 50px;\n  color: #149b9e;\n}\n\n/* slider input */\ninput[type=range].awg-edition-svg-zoom-slider {\n  width: 100%;\n  background-color: transparent;\n  -webkit-appearance: none;\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus {\n  outline: none;\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus::-ms-fill-lower {\n  background: rgba(221, 221, 221, 0.78);\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus::-ms-fill-upper {\n  background: #e5e5e5;\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus::-webkit-slider-runnable-track {\n  background: #e5e5e5;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-webkit-slider-runnable-track {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 1.3px;\n  width: 100%;\n  height: 31px;\n  cursor: pointer;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-webkit-slider-thumb {\n  width: 15px;\n  height: 29px;\n  background: #149b9e;\n  border: 1.8px solid #149b9e;\n  border-radius: 10px;\n  cursor: pointer;\n  -webkit-appearance: none;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-moz-range-track {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 1.3px;\n  width: 100%;\n  height: 29px;\n  cursor: pointer;\n  -moz-margin-start: fill;\n  margin-right: fill;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-moz-range-thumb {\n  width: 15px;\n  height: 27px;\n  background: #149b9e;\n  border: 1.8px solid #149b9e;\n  border-radius: 10px;\n  cursor: pointer;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-track {\n  background: transparent;\n  border-color: transparent;\n  border-width: 7.4px 0;\n  color: transparent;\n  width: 100%;\n  height: 31px;\n  cursor: pointer;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-fill-lower {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 2.6px;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-fill-upper {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 2.6px;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-thumb {\n  width: 15px;\n  height: 29px;\n  background: #149b9e;\n  border: 1.8px solid #149b9e;\n  border-radius: 10px;\n  cursor: pointer;\n  margin-top: 0px;\n  /*Needed to keep the Edge thumb centred*/\n}\n\n/* Next & previous buttons */\n.awg-edition-svg-sheet-viewer-nav {\n  /* Position the "next button" to the right */\n}\n.awg-edition-svg-sheet-viewer-nav > .prev,\n.awg-edition-svg-sheet-viewer-nav .next {\n  cursor: pointer;\n  position: absolute;\n  height: 100%;\n  top: 0;\n  width: auto;\n  padding: 8px;\n  -webkit-user-select: none;\n          user-select: none;\n  /* On hover, add a black background color with a little bit see-through */\n}\n.awg-edition-svg-sheet-viewer-nav > .prev:hover,\n.awg-edition-svg-sheet-viewer-nav .next:hover {\n  background-color: #dddddd;\n}\n.awg-edition-svg-sheet-viewer-nav > .prev span,\n.awg-edition-svg-sheet-viewer-nav .next span {\n  position: relative;\n  top: 45%;\n  font-weight: bold;\n  font-size: 18px;\n  transition: 0.6s ease;\n  color: #149b9e;\n}\n.awg-edition-svg-sheet-viewer-nav > .prev {\n  border-right: 1px solid #dddddd;\n}\n.awg-edition-svg-sheet-viewer-nav > .next {\n  right: 0;\n  border-left: 1px solid #dddddd;\n}',""]),d.exports=c.toString()},9335:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"",""]),d.exports=c.toString()},4756:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"/*\nsee also https://stackoverflow.com/questions/114543/how-to-horizontally-center-a-div-in-another-div\n */\n.svgGrid {\n  margin-bottom: 2em;\n}\n\n.svgRow {\n  padding-top: 1em;\n  width: inherit;\n  text-align: center;\n  box-shadow: 5px 5px 6px #cccccc;\n  border: 1px solid #eeeeee;\n}\n\n.svgCol {\n  display: inline-block;\n}",""]),d.exports=c.toString()},5262:(d,v,s)=>{var a=s(135),c=s(479)(a);c.push([d.id,"",""]),d.exports=c.toString()}}]);