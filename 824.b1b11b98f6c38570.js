(self.webpackChunkawg_app=self.webpackChunkawg_app||[]).push([[824],{3824:(d,g,i)=>{"use strict";i.r(g),i.d(g,{EditionSheetsModule:()=>$});var a=i(7582),t=i(9212),c=i(7410),X=i(1980);var j=i(3410),W=i.n(j);let x=class{constructor(){this.browseSvgSheetRequest=new t.vpe,this.navigateToReportFragmentRequest=new t.vpe,this.openModalRequest=new t.vpe,this.selectLinkBoxRequest=new t.vpe,this.selectOverlaysRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe}browseSvgSheet(e){e&&this.browseSvgSheetRequest.emit(e)}navigateToReportFragment(e){e&&this.navigateToReportFragmentRequest.emit(e)}openModal(e){e&&this.openModalRequest.emit(e)}selectLinkBox(e){this.selectLinkBoxRequest.emit(e)}selectOverlays(e){this.selectOverlaysRequest.emit(e)}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}static#e=this.propDecorators={svgSheetsData:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],selectedTextcriticalComments:[{type:t.IIB}],selectedTextcritics:[{type:t.IIB}],showTkA:[{type:t.IIB}],browseSvgSheetRequest:[{type:t.r_U}],navigateToReportFragmentRequest:[{type:t.r_U}],openModalRequest:[{type:t.r_U}],selectLinkBoxRequest:[{type:t.r_U}],selectOverlaysRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]}};x=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-accolade",template:'<div ngbAccordion>\n    <div ngbAccordionItem="awg-accolade-view" [collapsed]="false">\n        <div ngbAccordionHeader class="accordion-button awg-accordion-button-custom-header justify-content-between">\n            <button ngbAccordionToggle class="btn btn-link text-start p-0">Edierte Notentexte</button>\n            <button type="button" class="btn btn-sm btn-outline-info" (click)="openModal(\'HINT_EDITION_SHEETS\')">\n                Hinweise zur Nutzung\n            </button>\n        </div>\n        <div ngbAccordionCollapse>\n            <div ngbAccordionBody>\n                <ng-template>\n                    <div class="row">\n                        <div class="order-2 order-lg-1 col-12 col-lg-4 col-xl-3">\n                            \x3c!-- svg sheet navigation --\x3e\n                            @if (svgSheetsData && selectedSvgSheet) {\n                                <awg-edition-svg-sheet-nav\n                                    [svgSheetsData]="svgSheetsData"\n                                    [selectedSvgSheet]="selectedSvgSheet"\n                                    (selectSvgSheetRequest)="selectSvgSheet($event)">\n                                </awg-edition-svg-sheet-nav>\n                            }\n                        </div>\n                        <div class="order-1 order-lg-2 col-12 col-lg-8 col-xl-9">\n                            \x3c!-- svg sheet --\x3e\n                            @if (selectedSvgSheet) {\n                                <awg-edition-svg-sheet-viewer\n                                    [selectedSvgSheet]="selectedSvgSheet"\n                                    (browseSvgSheetRequest)="browseSvgSheet($event)"\n                                    (selectLinkBoxRequest)="selectLinkBox($event)"\n                                    (selectOverlaysRequest)="selectOverlays($event)"\n                                    (selectSvgSheetRequest)="selectSvgSheet($event)">\n                                </awg-edition-svg-sheet-viewer>\n                            }\n\n                            \x3c!-- table for TkA --\x3e\n                            @if (selectedSvgSheet && selectedTextcritics) {\n                                <awg-edition-svg-sheet-footer\n                                    [selectedTextcritics]="selectedTextcritics"\n                                    [selectedTextcriticalComments]="selectedTextcriticalComments"\n                                    [showTkA]="showTkA"\n                                    (navigateToReportFragmentRequest)="navigateToReportFragment($event)"\n                                    (openModalRequest)="openModal($event)"\n                                    (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-footer>\n                            }\n                        </div>\n                    </div>\n                </ng-template>\n            </div>\n        </div>\n    </div>\n</div>\n',changeDetection:t.n4l.OnPush,styles:[W()]})],x);var K=i(7703),Q=i.n(K),b=i(590),D=i(3539);let I=class{constructor(e){this.utils=e,this.navigateToReportFragmentRequest=new t.vpe,this.openModalRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.faChevronRight=b._tD,this.faChevronUp=b.mTx,this.showTextcritics=!1,this.ref=this}navigateToReportFragment(e){e&&this.navigateToReportFragmentRequest.emit(e)}openModal(e){e&&this.openModalRequest.emit(e)}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}toggleTextcritics(){this.showTextcritics=!this.showTextcritics}static#e=this.ctorParameters=()=>[{type:D.tI}];static#t=this.propDecorators={selectedTextcriticalComments:[{type:t.IIB}],selectedTextcritics:[{type:t.IIB}],showTkA:[{type:t.IIB}],navigateToReportFragmentRequest:[{type:t.r_U}],openModalRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]}};I=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-footer",template:'<div class="awg-edition-svg-sheet-footer mt-4">\n    <div class="awg-edition-svg-sheet-footer-evaluation">\n        <p (click)="toggleTextcritics()" style="cursor: pointer">\n            @if (selectedTextcritics.description && utils.isNotEmptyArray(selectedTextcritics.description)) {\n                <span>\n                    <fa-icon [icon]="showTextcritics ? faChevronUp : faChevronRight"></fa-icon>\n                    &nbsp;\n                </span>\n            }\n            <span class="caps">Skizzenkommentar:</span>\n            @if (selectedTextcritics.description && !utils.isNotEmptyArray(selectedTextcritics.description)) {\n                <span>&nbsp;---</span>\n            }\n        </p>\n        @if (\n            showTextcritics && selectedTextcritics.description && utils.isNotEmptyArray(selectedTextcritics.description)\n        ) {\n            @for (description of selectedTextcritics.description; track description) {\n                <p\n                    class="awg-edition-svg-sheet-footer-evaluation-desc"\n                    [compile-html]="description"\n                    [compile-html-ref]="ref"></p>\n            }\n        }\n    </div>\n    @if (showTkA) {\n        <div class="awg-edition-svg-sheet-footer-textcritics">\n            <p class="caps">Textkritischer Kommentar:</p>\n            <awg-edition-tka-table\n                [textcriticalComments]="selectedTextcriticalComments"\n                [isRowTable]="selectedTextcritics.rowtable"\n                (navigateToReportFragmentRequest)="navigateToReportFragment($event)"\n                (openModalRequest)="openModal($event)"\n                (selectSvgSheetRequest)="selectSvgSheet($event)">\n            </awg-edition-tka-table>\n        </div>\n    }\n</div>\n',changeDetection:t.n4l.OnPush,styles:[Q()]})],I);var ee=i(7229),te=i.n(ee);let k=class{constructor(){this.selectSvgSheetRequest=new t.vpe}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}static#e=this.propDecorators={svgSheetsData:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],selectSvgSheetRequest:[{type:t.r_U}]}};k=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-nav",template:'@if (svgSheetsData) {\n    <div class="awg-svg-sheet-nav card">\n        <div class="card-body">\n            <awg-edition-svg-sheet-nav-item\n                [navItemLabel]="\'Werkeditionen\'"\n                [svgSheets]="svgSheetsData.sheets.workEditions"\n                [selectedSvgSheet]="selectedSvgSheet"\n                (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-nav-item>\n            <hr />\n            <awg-edition-svg-sheet-nav-item\n                [navItemLabel]="\'Texteditionen\'"\n                [svgSheets]="svgSheetsData.sheets.textEditions"\n                [selectedSvgSheet]="selectedSvgSheet"\n                (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-nav-item>\n            <hr />\n            <awg-edition-svg-sheet-nav-item\n                [navItemLabel]="\'Skizzeneditionen\'"\n                [svgSheets]="svgSheetsData.sheets.sketchEditions"\n                [selectedSvgSheet]="selectedSvgSheet"\n                (selectSvgSheetRequest)="selectSvgSheet($event)"></awg-edition-svg-sheet-nav-item>\n        </div>\n    </div>\n}\n',changeDetection:t.n4l.OnPush,styles:[te()]})],k);var ie=i(4559),ne=i.n(ie);let L=class{constructor(e){this.utils=e,this.selectSvgSheetRequest=new t.vpe}isSelectedSvgSheet(e,s){let o=e,r=this.selectedSvgSheet.id;return s&&this.selectedSvgSheet.content?.[0]?.partial&&(o+=s,r+=this.selectedSvgSheet.content[0].partial),o===r}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}static#e=this.ctorParameters=()=>[{type:D.tI}];static#t=this.propDecorators={navItemLabel:[{type:t.IIB}],svgSheets:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],selectSvgSheetRequest:[{type:t.r_U}]}};L=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-nav-item",template:'<h6 class="card-title">\n    {{ navItemLabel }}:\n    @if (!utils.isNotEmptyArray(svgSheets)) {\n        <span>---</span>\n    }\n</h6>\n@for (svgSheet of svgSheets; track svgSheet) {\n    @if (svgSheet.content.length === 1) {\n        <a\n            class="btn btn-default w-100 awg-svg-sheet-nav-link card-text text-start"\n            [ngClass]="{ active: isSelectedSvgSheet(svgSheet.id), \'text-muted\': !isSelectedSvgSheet(svgSheet.id) }"\n            (click)="selectSvgSheet(svgSheet.id)">\n            {{ svgSheet.label }}\n        </a>\n    }\n    @if (svgSheet.content.length > 1) {\n        <div class="awg-svg-sheet-nav-link-dropdown" ngbDropdown>\n            <a\n                class="btn card-text"\n                id="dropDownSheetNav"\n                ngbDropdownToggle\n                [ngClass]="{ active: isSelectedSvgSheet(svgSheet.id), \'text-muted\': !isSelectedSvgSheet(svgSheet.id) }">\n                <span\n                    >{{ svgSheet.label }} <span class="badge bg-secondary">{{ svgSheet.content.length }}</span></span\n                >\n            </a>\n            <div ngbDropdownMenu aria-labelledby="dropdownSheetNav">\n                @for (svgSheetContent of svgSheet.content; track svgSheetContent; let i = $index) {\n                    <div>\n                        <a\n                            class="dropdown-item"\n                            [ngClass]="{\n                                active: isSelectedSvgSheet(svgSheet.id, svgSheetContent.partial),\n                                \'text-muted\': !isSelectedSvgSheet(svgSheet.id, svgSheetContent.partial)\n                            }"\n                            (click)="selectSvgSheet(svgSheet.id + svgSheetContent.partial)"\n                            >{{ svgSheet.label }}\n                            <span class="text-muted">[{{ i + 1 }}/{{ svgSheet.content.length }}]</span></a\n                        >\n                    </div>\n                }\n            </div>\n        </div>\n    }\n}\n',styles:[ne()]})],L);var oe=i(9671);var ae=i(7227),le=i.n(ae),P=i(8645),ce=i(3620),H=i(9773),de=i(2413),y=i(1166),C=i(7559),he=i(1313);let M=class{constructor(e){this.svgDrawingService=e,this.browseSvgSheetRequest=new t.vpe,this.selectLinkBoxRequest=new t.vpe,this.selectOverlaysRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.faCompressArrowsAlt=b.udn,this.sliderConfig=new de.w(1,.1,10,.01,1),this.svgSheetFilePath="",this._availableOverlays=[],this._selectedOverlays=[],this._isRendered=!1,this._resize$=new P.x,this._destroyed$=new P.x,this.ref=this}onResize(){!this.svgSheetSelection||!this.svgSheetRootGroupSelection||(this._getContainerDimensions(this.svgSheetContainerRef),this._resize$.next(!0))}ngOnChanges(){this._isRendered&&this.renderSheet()}ngAfterViewInit(){this._resize$.pipe((0,ce.b)(150),(0,H.R)(this._destroyed$)).subscribe(e=>{this.renderSheet()}),this.renderSheet(),this._isRendered=!0}ngOnDestroy(){this._destroyed$.next(!0),this._destroyed$.complete()}browseSvgSheet(e){e&&this.browseSvgSheetRequest.emit(e)}onZoomChange(e){this.sliderConfig.value=e,this._rescaleZoom()}renderSheet(){this._clearSVG(),this._availableOverlays=[],this._selectedOverlays=[],this.svgSheetFilePath=this.selectedSvgSheet?.content[0].svg,this._createSvg().then(()=>{this.resetZoom(),this._createSvgOverlays()})}resetZoom(){!this.svgSheetSelection||!this.sliderConfig||(this.onZoomChange(this.sliderConfig.initial),this._retranslateZoom())}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}_clearSVG(){this.svgSheetRootGroupSelection?.selectAll("*").remove(),this.svgSheetSelection?.selectAll("*").remove()}_createSvg(){var e=this;return(0,oe.Z)(function*(){e.svgSheetContainerRef?(e.svgSheetSelection=yield e.svgDrawingService.createSvg(e.svgSheetFilePath,e.svgSheetElementRef?.nativeElement,e.svgSheetRootGroupRef?.nativeElement),e.svgSheetRootGroupSelection=e.svgSheetSelection.select("#awg-edition-svg-sheet-root-group"),e._getContainerDimensions(e.svgSheetContainerRef),e._zoomHandler(e.svgSheetRootGroupSelection,e.svgSheetSelection)):console.warn("No svg sheet container ref")})()}_createSvgOverlays(){this.svgSheetRootGroupSelection&&(this._createOverlays("link-box",this._createLinkBoxOverlay.bind(this)),this._createOverlays("tkk",this._createTkkOverlay.bind(this)))}_createOverlays(e,s){const o=this.svgDrawingService.getGroupsBySelector(this.svgSheetRootGroupSelection,e);o&&o.nodes().forEach(r=>{s(r,e)})}_createLinkBoxOverlay(e,s){const o=e.id,r=this.svgDrawingService.getD3SelectionById(this.svgSheetRootGroupSelection,o),n=r.select("path");n.style("fill",this.svgDrawingService.linkBoxFillColor),r.on("mouseover",()=>{const l=this.svgDrawingService.linkBoxHoverFillColor;this.svgDrawingService.fillD3SelectionWithColor(n,l),r.style("cursor","pointer")}).on("mouseout",()=>{const l=this.svgDrawingService.linkBoxFillColor;this.svgDrawingService.fillD3SelectionWithColor(n,l)}).on("click",()=>{this._onLinkBoxSelect(o)})}_createTkkOverlay(e,s){const o=e.id,r=e.getBBox();this._availableOverlays.push(new y.OZ(y.wN.item,o,!1));const n=this._getOverlayById(this._availableOverlays,o),l=this.svgDrawingService.createOverlayGroup(this.svgSheetRootGroupSelection,o,r,s),v=this.svgDrawingService.getOverlayGroupRectSelection(this.svgSheetRootGroupSelection,o,s);l.on("mouseover",()=>{this.svgDrawingService.updateTkkOverlayColor(n,v,"hover"),v.style("cursor","pointer")}).on("mouseout",()=>{this.svgDrawingService.updateTkkOverlayColor(n,v,"fill")}).on("click",()=>{n&&(n.isSelected=!n.isSelected),this.svgDrawingService.updateTkkOverlayColor(n,v,"hover"),this._selectedOverlays=this._getSelectedOverlays(this._availableOverlays),this._onOverlaySelect(this._selectedOverlays)})}_getContainerDimensions(e){const s=this.svgDrawingService.getContainerDimensions(e);this._divWidth=this._divWidth?this._divWidth:s.width,this._divHeight=this._divHeight?this._divHeight:s.height}_getSelectedOverlays(e){return e.filter(s=>s.isSelected)}_getOverlayById(e,s){return e.find(o=>o.id===s)}_onOverlaySelect(e){this.selectOverlaysRequest.emit(e)}_onLinkBoxSelect(e){this.selectLinkBoxRequest.emit(e)}_rescaleZoom(){!this.svgSheetSelection||!this.sliderConfig.value||this._zoomBehaviour.scaleTo(this.svgSheetSelection,this.sliderConfig.value)}_retranslateZoom(){this.svgSheetSelection&&this.svgSheetRootGroupSelection.attr("transform","translate(0,0)")}_roundToNearestScaleStep(e){const s=this.sliderConfig.stepSize;return((n,l)=>+(Math.round(+(n+"e"+l))+"e-"+l))(e,(n=s,Math.floor(n)===n?0:n.toString().split(".")[1].length||0));var n}_zoomHandler(e,s){this._zoomBehaviour=he.sP().scaleExtent([this.sliderConfig.min,this.sliderConfig.max]).on("zoom",r=>{const n=r.transform,l=this._roundToNearestScaleStep(n.k);e.attr("transform",n),this.sliderInput&&this.sliderInput.nativeElement&&(this.sliderInput.nativeElement.value=l,this.sliderConfig.value=l),this.sliderInputLabel&&this.sliderInputLabel.nativeElement&&(this.sliderInputLabel.nativeElement.innerText=l+"x")}),s.call(this._zoomBehaviour)}static#e=this.ctorParameters=()=>[{type:C.Rt}];static#t=this.propDecorators={svgSheetContainerRef:[{type:t.i9L,args:["svgSheetContainer"]}],svgSheetElementRef:[{type:t.i9L,args:["svgSheetElement"]}],svgSheetRootGroupRef:[{type:t.i9L,args:["svgSheetRootGroup"]}],sliderInput:[{type:t.i9L,args:["sliderInput"]}],sliderInputLabel:[{type:t.i9L,args:["sliderInputLabel"]}],selectedSvgSheet:[{type:t.IIB}],browseSvgSheetRequest:[{type:t.r_U}],selectLinkBoxRequest:[{type:t.r_U}],selectOverlaysRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}],onResize:[{type:t.L6J,args:["window:resize"]}]}};M=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-svg-sheet-viewer",template:'@if (selectedSvgSheet) {\n    <div id="awg-edition-svg-container">\n        <div class="awg-edition-svg-sheet-viewer">\n            <div class="awg-edition-svg-icon-bar">\n                \x3c!-- Slider --\x3e\n                <div class="input-group input-group-sm awg-edition-svg-zoom-slider-container float-start m-2">\n                    <span #sliderInputLabel class="input-group-text" id="slider-label">{{ sliderConfig.value }}x</span>\n                    <input\n                        type="range"\n                        #sliderInput\n                        class="awg-edition-svg-zoom-slider"\n                        id="awg-edition-svg-zoom-slider"\n                        name="zoomSlider"\n                        aria-label="Zoom slider"\n                        aria-describedby="slider-label"\n                        [min]="sliderConfig.min"\n                        [max]="sliderConfig.max"\n                        [step]="sliderConfig.stepSize"\n                        [(ngModel)]="sliderConfig.value"\n                        (ngModelChange)="onZoomChange($event)" />\n                    <button class="btn btn-sm btn-outline-info" type="submit" title="Reset zoom" (click)="resetZoom()">\n                        <fa-icon [icon]="faCompressArrowsAlt"></fa-icon>\n                    </button>\n                </div>\n            </div>\n            <div #svgSheetContainer class="awg-edition-svg-sheet-container">\n                <svg #svgSheetElement id="awg-edition-svg-sheet">\n                    <g #svgSheetRootGroup id="awg-edition-svg-sheet-root-group"></g>\n                </svg>\n                <awg-license class="d-flex mt-3 text-center small"></awg-license>\n            </div>\n        </div>\n        \x3c!-- Next and previous buttons --\x3e\n        <div class="awg-edition-svg-sheet-viewer-nav">\n            <div class="prev" (click)="browseSvgSheet(-1)">\n                <span>&#10094;</span>\n            </div>\n            <div class="next" (click)="browseSvgSheet(1)">\n                <span>&#10095;</span>\n            </div>\n        </div>\n    </div>\n}\n',styles:[le()]})],M);let B=class{};B=(0,a.gn)([(0,t.LVF)({imports:[c.m,X.K],declarations:[x,I,k,L,M],exports:[x]})],B);var ge=i(1333),Se=i.n(ge);let O=class{constructor(){this.openModalRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.faSquare=b.pL1,this.folioLegends=[{color:"olivedrab",label:"aktuell ausgew\xe4hlt"},{color:"orange",label:"ausw\xe4hlbar"},{color:"grey",label:"(momentan noch) nicht ausw\xe4hlbar"}]}openModal(e){e&&this.openModalRequest.emit(e)}selectSvgSheet(e){e&&this.selectSvgSheetRequest.emit(e)}static#e=this.propDecorators={selectedConvolute:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],openModalRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]}};O=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-convolute",template:'<div ngbAccordion>\n    <div ngbAccordionItem="awg-convolute-view" [collapsed]="false">\n        <div ngbAccordionHeader>\n            <button ngbAccordionButton>Konvolut\xfcbersicht</button>\n        </div>\n        <div ngbAccordionCollapse>\n            <div ngbAccordionBody>\n                <ng-template>\n                    \x3c!-- convolute label --\x3e\n                    <div class="awg-convolute-label">\n                        <p>\n                            <a [routerLink]="[\'../report\']" fragment="source{{ selectedConvolute.convoluteId }}">{{\n                                selectedConvolute.convoluteLabel\n                            }}</a>\n                        </p>\n                    </div>\n\n                    \x3c!-- viewer for convolute folios --\x3e\n                    <awg-edition-folio-viewer\n                        [selectedConvolute]="selectedConvolute"\n                        [selectedSvgSheet]="selectedSvgSheet"\n                        (openModalRequest)="openModal($event)"\n                        (selectSvgSheetRequest)="selectSvgSheet($event)">\n                    </awg-edition-folio-viewer>\n\n                    \x3c!-- convolute legend --\x3e\n                    <div class="awg-convolute-legend col-12">\n                        Legende:&nbsp;\n                        @for (legend of folioLegends; track legend) {\n                            <span class="{{ legend.color }}">\n                                <fa-icon [icon]="faSquare"></fa-icon>\n                                {{ legend.label }}\n                            </span>\n                        }\n                    </div>\n                </ng-template>\n            </div>\n        </div>\n    </div>\n</div>\n',changeDetection:t.n4l.OnPush,styles:[Se()]})],O);var ue=i(29),me=i.n(ue);let F=class{constructor(){this._itemsOffsetCorrection=4}getFolioSvgData(e,s){const o=new y.jD(e,s,this._itemsOffsetCorrection);return new y.Hb(o)}addViewBoxToSnapSvgCanvas(e,s){e.attr({viewBox:s.viewBox,width:s.svgWidth,height:s.svgHeight,version:"1.1",xmlns:"https://www.w3.org/2000/svg",xlink:"https://www.w3.org/1999/xlink",preserveAspectRatio:"xMinYMin meet"})}addFolioToSnapSvgCanvas(e,s,o,r,n){this.ref=n;const l=e.group();this._addFolioSheetToSnapSvgCanvas(e,l,s,o),this._addFolioSystemsToSnapSvgCanvas(e,l,s,o),this._addFolioItemsToSnapSvgCanvas(e,l,s,r)}_addFolioSheetToSnapSvgCanvas(e,s,o,r){const n=o.sheet.folioId,l=o.sheet.upperLeftCorner.x,v=o.sheet.upperLeftCorner.y,u=o.sheet.lowerRightCorner.x,m=o.sheet.lowerRightCorner.y;s.attr({sheetGroupId:n,class:"sheet-group"});const _=e.rect(l,v,u,m);_.attr({fill:"white",stroke:r,strokeWidth:1});const f=Snap.parse("<title>Bl. "+n+"</title>");s.append(f),s.add(_)}_addFolioSystemsToSnapSvgCanvas(e,s,o,r){o.systems.lineArrays.forEach((n,l)=>{const v=e.group();v.attr({systemLineGroupId:l+1,class:"system-line-group"}),n.forEach(w=>{const R=w.startPoint.x,p=w.startPoint.y,U=w.endPoint.x,be=w.endPoint.y,V=e.line(R,p,U,be);V.attr({class:"system-line",stroke:r,strokeWidth:.7}),v.add(V)});const u=o.systems.lineLabelArray[l].x,m=o.systems.lineLabelArray[l].y,_=l+1,f=e.text(u,m,_);f.attr({class:"system-label",dominantBaseline:"hanging",fill:r});const S=e.group(v,f);S.attr({systemsGroupId:l+1,class:"systems-group"}),s.add(S)})}_addFolioItemsToSnapSvgCanvas(e,s,o,r){o.contentItemsArray.forEach(n=>{if(!n)return;const l=n.upperLeftCorner.x+n.width/2,v=n.upperLeftCorner.y+n.height/2,u=n.sigleAddendum?[n.sigle," "+n.sigleAddendum]:[n.sigle],m=e.text(0,0,u);m.attr({class:"item-label",style:"font: 12px Source Sans Pro, source-sans-pro, sans-serif",dominantBaseline:"middle"});const _="middle";m.select("tspan:first-of-type").attr({x:l,y:v,textAnchor:_}),u.length>1&&m.select("tspan:last-of-type").attr({x:l,y:v,textAnchor:_,dy:"1.2em"});const f=e.group(),S=[];S.push(n.cornerPoints.upperLeftCorner.x,n.cornerPoints.upperLeftCorner.y),S.push(n.cornerPoints.upperRightCorner.x,n.cornerPoints.upperRightCorner.y),S.push(n.cornerPoints.lowerRightCorner.x,n.cornerPoints.lowerRightCorner.y),S.push(n.cornerPoints.lowerLeftCorner.x,n.cornerPoints.lowerLeftCorner.y),S.push(n.cornerPoints.upperLeftCorner.x,n.cornerPoints.upperLeftCorner.y);const w=e.polyline(S);f.add(w),f.attr({class:"item-shape",strokeWidth:2,fill:"#eeeeee"});const R=e.el("a");R.attr({class:"item-link"}),R.add(f),R.add(m);const p=e.group(R);p.attr({itemGroupId:u,itemId:n.id,class:"item-group"});const U=Snap.parse("<title>"+u+"</title>");p.append(U),!1===n.selectable?(p.click(()=>this.ref.openModal(n.linkTo)),p.attr({stroke:"grey",fill:"grey"})):(p.click(()=>this.ref.selectSvgSheet(n.id)),p.attr({stroke:r,fill:r})),s.add(p)})}};F=(0,a.gn)([(0,t.GSi)({providedIn:"root"})],F);let T=class{constructor(e){this.folioService=e,this.openModalRequest=new t.vpe,this.selectSvgSheetRequest=new t.vpe,this.canvasArray=[],this.folioSvgData=[],this.vbArray=[],this.bgColor="#a3a3a3",this.fgColor="orange",this._folioSettings={factor:1.5,formatX:175,formatY:270,initialOffsetX:5,initialOffsetY:5,numberOfFolios:0},this.ref=this}get folioSettings(){return this._folioSettings}set folioSettings(e){this._folioSettings=e}ngOnChanges(e){e.selectedConvolute&&this.prepareFolioSvgOutput()}ngAfterViewChecked(){this.createSVGCanvas()}isSelectedSvgSheet(e){let s="";return this.selectedSvgSheet.content[0].partial&&(s=this.selectedSvgSheet.content[0].partial),e===this.selectedSvgSheet.id+s}prepareFolioSvgOutput(){this.folioSvgData=[],this.selectedConvolute.folios.forEach((e,s)=>{this.folioSettings={factor:this.folioSettings.factor,formatX:+e.format.width,formatY:+e.format.height,initialOffsetX:this.folioSettings.initialOffsetX,initialOffsetY:this.folioSettings.initialOffsetY,numberOfFolios:+this.selectedConvolute.folios.length};const o=(this.folioSettings.formatX+2*this.folioSettings.initialOffsetX)*this.folioSettings.factor,r=(this.folioSettings.formatY+2*this.folioSettings.initialOffsetY)*this.folioSettings.factor;this.vbArray[s]=new y.HA(o,r),this.folioSvgData[s]=this.folioService.getFolioSvgData(this.folioSettings,e)})}createSVGCanvas(){this.canvasArray=[],this.folioSvgData.forEach((e,s)=>{const o="#folio-"+this.selectedSvgSheet.id+"-"+e.sheet.folioId,r=Snap(o);r&&(this.folioService.addViewBoxToSnapSvgCanvas(r,this.vbArray[s]),this.folioService.addFolioToSnapSvgCanvas(r,e,this.bgColor,this.fgColor,this.ref),this.canvasArray.push(r))}),this.toggleActiveClass()}toggleActiveClass(){this.canvasArray&&this.canvasArray.forEach(e=>{e.selectAll(".item-group").forEach(s=>{const o=s.node.attributes.itemId.value;s.toggleClass("active",this.isSelectedSvgSheet(o))})})}openModal(e){this.openModalRequest.emit(e)}selectSvgSheet(e){this.selectSvgSheetRequest.emit(e)}static#e=this.ctorParameters=()=>[{type:F}];static#t=this.propDecorators={selectedConvolute:[{type:t.IIB}],selectedSvgSheet:[{type:t.IIB}],openModalRequest:[{type:t.r_U}],selectSvgSheetRequest:[{type:t.r_U}]}};T=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-folio-viewer",template:'\x3c!-- embedded svg: EditionSvgSheet Overview --\x3e\n@if (folioSvgData) {\n    <div class="container-fluid svgGrid">\n        <div class="row svgRow">\n            @for (folio of folioSvgData; track folio) {\n                <div class="col-sm-6 col-lg-{{ 12 / folioSvgData?.length }} svgCol">\n                    <span class="text-muted">[{{ folio.sheet.folioId }}]</span>\n                    <svg id="folio-{{ selectedSvgSheet.id }}-{{ folio.sheet.folioId }}"></svg>\n                </div>\n            }\n        </div>\n    </div>\n}\n',changeDetection:t.n4l.OnPush,styles:[me()]})],T);let z=class{};z=(0,a.gn)([(0,t.LVF)({imports:[c.m],declarations:[T],exports:[T]})],z);let N=class{};N=(0,a.gn)([(0,t.LVF)({imports:[c.m,z],declarations:[O],exports:[O]})],N);var E=i(6158);var _e=i(7572),we=i.n(_e),q=i(4664),Re=i(8943);let A=class{constructor(e,s,o,r,n,l){this.editionDataService=e,this.editionSheetsService=s,this.editionService=o,this.utils=r,this.route=n,this.router=l,this.errorMessage=void 0,this.showTkA=!1,this._destroyed$=new P.x}get editionRouteConstants(){return Re.LL}ngOnInit(){this.getEditionSheetsData()}getEditionSheetsData(){this.route.paramMap.pipe((0,q.w)(()=>this.editionService.getEditionComplex()),(0,q.w)(e=>(this.editionComplex=e,this.editionDataService.getEditionSheetsData(this.editionComplex))),(0,q.w)(e=>(this.folioConvoluteData=e[0],this.svgSheetsData=e[1],this.textcriticsData=e[2],this.route.queryParamMap)),(0,H.R)(this._destroyed$)).subscribe({next:e=>{this._selectSvgSheet(e)},error:e=>{this.errorMessage=e}})}onLinkBoxSelect(e){if(!this.selectedSvgSheet||!this.selectedTextcritics?.linkBoxes)return;const s=this.selectedTextcritics.linkBoxes.find(o=>o.svgGroupId===e);if(s){const o=s.linkTo;this.onSvgSheetSelect(o)}}onNavigateToReportFragment(e){e||(e="");const s={fragment:e};this.router.navigate([this.editionComplex.baseRoute,this.editionRouteConstants.EDITION_REPORT.route],s)}onOverlaySelect(e){this.selectedTextcriticalComments=this.editionSheetsService.getTextcriticalCommentsForOverlays(this.selectedTextcritics.comments,e),this.showTkA=this.utils.isNotEmptyArray(this.selectedTextcriticalComments)}onBrowseSvgSheet(e){const s=this.editionSheetsService.getCurrentEditionType(this.selectedSvgSheet,this.svgSheetsData.sheets);if(!s)return;const o=this.svgSheetsData.sheets[s],r=this.editionSheetsService.getNextSheetId(e,this.selectedSvgSheet,o);this.onSvgSheetSelect(r)}onSvgSheetSelect(e){e||(e=this.svgSheetsData.sheets.sketchEditions[0].id);const s={queryParams:{id:e},queryParamsHandling:"merge"};this.router.navigate([this.editionComplex.baseRoute,this.editionRouteConstants.EDITION_SHEETS.route],s)}ngOnDestroy(){this._destroyed$.next(!0),this._destroyed$.complete()}_getIdFromQueryParams(e){return e.get("id")?e.get("id"):this.svgSheetsData.sheets.sketchEditions[0].id}_selectSvgSheet(e){const s=this._getIdFromQueryParams(e);this.selectedSvgSheet=this.editionSheetsService.selectSvgSheetById(this.svgSheetsData.sheets,s),this.selectedConvolute=this.editionSheetsService.selectConvolute(this.folioConvoluteData.convolutes,this.svgSheetsData.sheets,this.selectedSvgSheet),this.selectedTextcritics=this.editionSheetsService.findTextcritics(this.textcriticsData.textcritics,this.selectedSvgSheet),this.onOverlaySelect([]),this.utils.isNotEmptyObject(this.selectedTextcritics)&&this.utils.isNotEmptyArray(this.selectedTextcritics.comments)&&(this.selectedTextcriticalComments=this.selectedTextcritics.comments)}static#e=this.ctorParameters=()=>[{type:C.Ko},{type:C.rH},{type:C.OE},{type:D.tI},{type:E.gz},{type:E.F0}];static#t=this.propDecorators={modal:[{type:t.i9L,args:["modal",{static:!0}]}]}};A=(0,a.gn)([(0,t.wA2)({selector:"awg-edition-sheets",template:'\x3c!-- content: edition detail --\x3e\n<div>\n    \x3c!-- modal --\x3e\n    <awg-modal #modal></awg-modal>\n\n    \x3c!-- body with embedded svg\'s --\x3e\n    \x3c!-- accolade view --\x3e\n    @if (svgSheetsData && selectedSvgSheet) {\n        <awg-edition-accolade\n            [svgSheetsData]="svgSheetsData"\n            [selectedSvgSheet]="selectedSvgSheet"\n            [selectedTextcritics]="selectedTextcritics"\n            [selectedTextcriticalComments]="selectedTextcriticalComments"\n            [showTkA]="showTkA"\n            (browseSvgSheetRequest)="onBrowseSvgSheet($event)"\n            (navigateToReportFragmentRequest)="onNavigateToReportFragment($event)"\n            (openModalRequest)="modal.open($event)"\n            (selectLinkBoxRequest)="onLinkBoxSelect($event)"\n            (selectOverlaysRequest)="onOverlaySelect($event)"\n            (selectSvgSheetRequest)="onSvgSheetSelect($event)">\n        </awg-edition-accolade>\n    }\n\n    \x3c!-- convolute view --\x3e\n    @if (selectedConvolute && selectedSvgSheet) {\n        <awg-edition-convolute\n            [selectedConvolute]="selectedConvolute"\n            [selectedSvgSheet]="selectedSvgSheet"\n            (openModalRequest)="modal.open($event)"\n            (selectSvgSheetRequest)="onSvgSheetSelect($event)">\n        </awg-edition-convolute>\n    }\n</div>\n',styles:[we()]})],A);const ye=[{path:"",component:A,data:{title:"AWG Online Edition \u2013 Sheets"}}],xe=[A];let G=class{};G=(0,a.gn)([(0,t.LVF)({imports:[E.Bz.forChild(ye)],exports:[E.Bz]})],G);let $=class{};$=(0,a.gn)([(0,t.LVF)({imports:[c.m,B,N,G],declarations:[xe]})],$)},3410:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"",""]),d.exports=c.toString()},7703:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"",""]),d.exports=c.toString()},4559:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"a#dropDownSheetNav.btn {\n  border: none !important;\n}\na#dropDownSheetNav.active, a#dropDownSheetNav:active {\n  color: #149b9e !important;\n}\na#dropDownSheetNav:hover {\n  color: rgb(51, 51, 51) !important;\n}\na#dropDownSheetNav > span {\n  display: inline-block;\n  white-space: break-spaces;\n  text-align: start;\n}",""]),d.exports=c.toString()},7229:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"",""]),d.exports=c.toString()},7227:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,'#awg-edition-svg-container {\n  position: relative;\n  width: 100%;\n}\n#awg-edition-svg-container > .awg-edition-svg-icon-bar {\n  position: relative;\n  width: 100%;\n}\n\n.awg-edition-svg-sheet-container {\n  position: inherit;\n  height: 100%;\n  padding-left: 2rem;\n  padding-right: 2rem;\n}\n\n/* slider */\n.input-group.awg-edition-svg-zoom-slider-container {\n  flex-wrap: nowrap;\n  width: auto;\n  margin-left: 2rem !important;\n}\n.input-group.awg-edition-svg-zoom-slider-container > :not(:first-child) {\n  margin-left: 0px !important;\n}\n\n#slider-label.input-group-text {\n  min-width: 50px;\n  color: #149b9e;\n}\n\n/* slider input */\ninput[type=range].awg-edition-svg-zoom-slider {\n  width: 100%;\n  background-color: transparent;\n  -webkit-appearance: none;\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus {\n  outline: none;\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus::-ms-fill-lower {\n  background: rgba(221, 221, 221, 0.78);\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus::-ms-fill-upper {\n  background: #e5e5e5;\n}\ninput[type=range].awg-edition-svg-zoom-slider:focus::-webkit-slider-runnable-track {\n  background: #e5e5e5;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-webkit-slider-runnable-track {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 1.3px;\n  width: 100%;\n  height: 31px;\n  cursor: pointer;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-webkit-slider-thumb {\n  width: 15px;\n  height: 29px;\n  background: #149b9e;\n  border: 1.8px solid #149b9e;\n  border-radius: 10px;\n  cursor: pointer;\n  -webkit-appearance: none;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-moz-range-track {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 1.3px;\n  width: 100%;\n  height: 29px;\n  cursor: pointer;\n  -moz-margin-start: fill;\n  margin-right: fill;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-moz-range-thumb {\n  width: 15px;\n  height: 27px;\n  background: #149b9e;\n  border: 1.8px solid #149b9e;\n  border-radius: 10px;\n  cursor: pointer;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-track {\n  background: transparent;\n  border-color: transparent;\n  border-width: 7.4px 0;\n  color: transparent;\n  width: 100%;\n  height: 31px;\n  cursor: pointer;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-fill-lower {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 2.6px;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-fill-upper {\n  background: rgba(221, 221, 221, 0.78);\n  border: 0.2px solid #dddddd;\n  border-radius: 2.6px;\n}\ninput[type=range].awg-edition-svg-zoom-slider::-ms-thumb {\n  width: 15px;\n  height: 29px;\n  background: #149b9e;\n  border: 1.8px solid #149b9e;\n  border-radius: 10px;\n  cursor: pointer;\n  margin-top: 0px;\n  /*Needed to keep the Edge thumb centred*/\n}\n\n/* Next & previous buttons */\n.awg-edition-svg-sheet-viewer-nav {\n  /* Position the "next button" to the right */\n}\n.awg-edition-svg-sheet-viewer-nav > .prev,\n.awg-edition-svg-sheet-viewer-nav .next {\n  cursor: pointer;\n  position: absolute;\n  height: 100%;\n  top: 0;\n  width: auto;\n  padding: 8px;\n  -webkit-user-select: none;\n          user-select: none;\n  /* On hover, add a black background color with a little bit see-through */\n}\n.awg-edition-svg-sheet-viewer-nav > .prev:hover,\n.awg-edition-svg-sheet-viewer-nav .next:hover {\n  background-color: #dddddd;\n}\n.awg-edition-svg-sheet-viewer-nav > .prev span,\n.awg-edition-svg-sheet-viewer-nav .next span {\n  position: relative;\n  top: 45%;\n  font-weight: bold;\n  font-size: 18px;\n  transition: 0.6s ease;\n  color: #149b9e;\n}\n.awg-edition-svg-sheet-viewer-nav > .prev {\n  border-right: 1px solid #dddddd;\n}\n.awg-edition-svg-sheet-viewer-nav > .next {\n  right: 0;\n  border-left: 1px solid #dddddd;\n}',""]),d.exports=c.toString()},1333:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"",""]),d.exports=c.toString()},29:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"/*\nsee also https://stackoverflow.com/questions/114543/how-to-horizontally-center-a-div-in-another-div\n */\n.svgGrid {\n  margin-bottom: 2em;\n}\n\n.svgRow {\n  padding-top: 1em;\n  width: inherit;\n  text-align: center;\n  box-shadow: 5px 5px 6px #cccccc;\n  border: 1px solid #eeeeee;\n}\n\n.svgCol {\n  display: inline-block;\n}",""]),d.exports=c.toString()},7572:(d,g,i)=>{var a=i(4969),c=i(1451)(a);c.push([d.id,"",""]),d.exports=c.toString()}}]);